var Controllers = angular.module('Controllers', []);

Controllers.controller('RootController', ['$scope','AuthService',
    function($scope, AuthService) {        
        $scope.SessionUser=undefined;
        
        $scope.defaultSuccessCallback=function(data, headers){ 
        };
        
        $scope.defaultErrorCallback=function(httpResponse) {
            if(httpResponse.headers("X-Session-Status")=="Timeout" || $scope.SessionUser==undefined){
                var loc=window.location+"";
                if(loc.search("#/login") == -1){
                    alert("Su Sesi√≥n ha expirado");
                    window.location = "#/login";
                }
                
            } else if(httpResponse.status=="403"){
                alert("Accion no permitida");
                window.location = "#/index";
            } else {
                alert(httpResponse.headers("X-Error-Message"));
            }
        };
        
        $scope.login=function(){
            $scope.SessionUser=AuthService.login({User: $scope.User, Password: $scope.Password},
                function(data, headers){
                    $scope.Password="";
                    window.location="#/index";
                },
                $scope.defaultErrorCallback
            );
        };
        
        $scope.logout=function(){
            AuthService.logout({User: $scope.User, Password: $scope.Password},
                function(data, headers){
                    $scope.SessionUser=undefined;
                    window.location="#/login";
                },
                $scope.defaultErrorCallback
            );
        };
        
        $scope.hasProfile=function(arrProfileId){
            return arrProfileId.indexOf($scope.SessionUser.UserLevel)!= -1;
        };
        
        $scope.SessionUser=AuthService.check({}, $scope.defaultSuccessCallback, 
            $scope.defaultErrorCallback
        );
    }
]);


Controllers.controller('IndexController', ['$scope',
    function($scope) {
        //alert("Index");
    }        
]);